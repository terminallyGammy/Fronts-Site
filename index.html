<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Current Fronters</title>
  <style>
    :root {
      --card-w: 680px;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #fdfdfd;
      color: #333;
      max-width: var(--card-w);
      margin: 2rem auto;
      padding: 1rem;
      text-align: center;
    }
    h1 { letter-spacing: 0.5px; margin-bottom: 1rem; }
    .front {
      margin: 0.5rem auto;
      padding: 0.9rem 1rem;
      border: 1px solid #ddd;
      border-radius: 12px;
      background: #fafafa;
      text-align: left;
      display: grid;
      grid-template-columns: 56px 1fr;
      grid-gap: 12px;
      align-items: center;
      width: 100%;
      box-sizing: border-box;
    }
    .avatar {
      width: 56px; height: 56px; border-radius: 50%;
      background: #eee; object-fit: cover; border: 1px solid #ddd;
    }
    .title { font-weight: 600; }
    .subtle { opacity: 0.8; font-size: 0.95rem; }
    .warning {
      grid-column: 1 / -1;
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #fff6f6;
      border: 1px solid #f3c2c2;
      color: #8b2c2c;
      font-size: 0.95rem;
      white-space: pre-wrap;
    }
    .note { font-size: 0.9rem; opacity: 0.8; margin-top: 0.75rem; }
  </style>
</head>
<body>
  <h1>⋆˚✿˖°Current Fronters⋆˚✿˖°</h1>
  <div id="fronts">Loading...</div>
  <div class="note" id="meta"></div>

  <script>
async function loadFronts() {
  const out = document.getElementById("fronts");
  const meta = document.getElementById("meta");
  try {
    const res = await fetch(`./fronts.json?v=${Date.now()}`, { cache: "no-store" });
    const data = await res.json();

    const list = Array.isArray(data?.membersFronting) ? data.membersFronting : [];
    if (!list.length) {
      out.textContent = "No one fronting right now.";
      meta.textContent = data?.lastChange ? ("Last change: " + new Date(data.lastChange).toLocaleString()) : "";
      return;
    }

    out.innerHTML = list.map(m => {
      const name = m.displayName || m.name || m.id || "Unnamed";
      const pr   = m.pronouns ? `<div style="opacity:.8">${m.pronouns}</div>` : "";
      const warn = m.warning ? `<div style="margin-top:.5rem;padding:.5rem;border-radius:6px;background:#fff3cd;border:1px solid #ffe69c;text-align:left;white-space:pre-wrap">${m.warning}</div>` : "";
      const img  = m.avatar ? `<img src="${m.avatar}" alt="${name}" style="width:64px;height:64px;border-radius:50%;object-fit:cover;display:block;margin:0 auto .5rem">` : "";
      const border = m.color || "#ddd";
      return `
        <div class="front" style="border-left:8px solid ${border};">
          ${img}
          <div><strong>${name}</strong></div>
          ${pr}
          ${warn}
        </div>
      `;
    }).join("");

    meta.textContent = data?.lastChange ? ("Last change: " + new Date(data.lastChange).toLocaleString()) : "";
  } catch (e) {
    out.textContent = "Error loading fronts.";
    console.error(e);
  }
}
loadFronts();
</script>
</body>
</html>
